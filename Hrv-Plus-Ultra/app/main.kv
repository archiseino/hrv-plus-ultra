#:import ShadowBox widgets.containers.ShadowBox
#:import Text widgets.inputs.Text
#:import IconButton widgets.buttons.IconButton
#:import OverlayContainer widgets.containers.OverlayContainer
#:import StatusBox widgets.containers.StatusBox
#:import ProgressBarWidget widgets.utils.ProgressBarWidget

# Home Monitoring Section
<StressMonitorLayout>:
    padding: dp(16)
    spacing: dp(16)
    canvas.before:
        Color:
            rgba: app.colors.grey_light
        Rectangle:
            pos: self.pos
            size: self.size

    ## Container for Camera and Graph
    BoxLayout:
        orientation: 'vertical'
        Text:
            size_hint_y: 0.05
            text: "Phys-App"

        BoxLayout:
            spacing: dp(10)
            
            ## Camera Section 
            AnchorLayout:
                anchor_y: 'top'
                size_hint_x: 0.4
                ShadowBox:
                    radius: [dp(8)] ## Rounded 16dp
                    elevation: 2
                    size_hint: 1, 0.7
                    padding: dp(16)
                    spacing: dp(8)
                    orientation: "vertical" 
                    BoxLayout:
                        size_hint_y: .1
                        orientation: 'horizontal'
                        AnchorLayout:
                            anchor_x: 'left'
                            anchor_y: 'center'
                            Text:
                                text: "Camera Feed"
                                font_name: app.fonts.body
                                font_size: app.fonts.size.h3
                                color: app.colors.black
                        AnchorLayout:
                            anchor_x: 'right'
                            anchor_y: 'center'
                            IconButton:
                                size_hint: None, None
                                size: dp(16), dp(16)
                                source: app.resource_path('assets/icons/camera-solid.png')
                    
                    BoxLayout: 
                        size_hint_y: 0.5
                        CameraLayout:

                    BoxLayout:
                        size_hint_y: .1
                        orientation: 'horizontal'
                        AnchorLayout:
                            anchor_x: 'left'
                            anchor_y: 'center'
                            Text:
                                text: "Status Camera: On"
                                font_name: app.fonts.body
                                font_size: app.fonts.size.h5
                                color: app.colors.primary
                        AnchorLayout:
                            anchor_x: 'right'
                            anchor_y: 'center'
                            IconButton:
                                size_hint: None, None
                                size: dp(16), dp(16)
                                source: app.resource_path('assets/icons/circle-solid.png')
                    
                    
            ## Physiology Section
            AnchorLayout:
                anchor_y: 'top'
                size_hint_x: 0.6
                ShadowBox:
                    radius: [dp(16)] ## Rounded 16dp
                    elevation: 2
                    size_hint: 1, 1
                    padding: dp(16)
                    spacing: dp(8)
                    orientation: "vertical" 

                    BoxLayout:
                        size_hint_y: 0.2
                        orientation: 'horizontal'

                        AnchorLayout:
                            anchor_x: 'left'
                            anchor_y: 'center'
                            Text:
                                text: "Heart Rate"
                                font_name: app.fonts.body
                                font_size: app.fonts.size.h3
                                color: app.colors.black
                        AnchorLayout:
                            anchor_x: 'right'
                            anchor_y: 'center'
                            padding: dp(4)
                                            
                            BoxLayout:
                                size_hint_x: None  
                                spacing: dp(12)  ## Ensures space between Text and Icon
                                padding: dp(4)  

                                BoxLayout:
                                    spacing: dp(4)  
                                    Text:
                                        text: "75"
                                        font_name: app.fonts.body
                                        font_size: app.fonts.size.h2
                                        color: app.colors.danger
                                        width: self.texture_size[0]
                                    Text:
                                        text: "BPM"
                                        font_name: app.fonts.body
                                        font_size: app.fonts.size.h4
                                        color: app.colors.black
                                        width: self.texture_size[0] 

                    BoxLayout:
                        size_hint_y: 0.6
                        OverlayContainer:
                            padding: dp(10)
                            radius: [dp(8)] ## Rounded 16dp
                            MatplotFigure:
                                id: figure_hr


                    ## Physiology Status StatusIndicator
                    BoxLayout:
                        size_hint: 1, 0.4
                        padding: dp(8)
                        spacing: dp(8)
                        HrBox:
                            id: hr_box
                            label: "Heart Rate"
                            unit: "BPM"
                        
                        SpO2Box:
                            id: spo2_box
                            label: "SpO2 Rate"
                            unit: "%"


                    BoxLayout:
                        size_hint: 1, 0.4
                        padding: dp(8)
                        spacing: dp(8)
                        HrvBox:
                            id: hrv_box
                            label: "Hrv Rate"
                            unit: "ms"

                        RespBox:
                            id: resp_box
                            label: "Resp Rate"
                            unit: "BPM"

                    BoxLayout:
                        size_hint_y: 0.15
                        orientation: 'vertical'
                        Text:
                            text:"Stress Indicator"
                        ProgressBarWidget:

<CameraLayout>:
    allow_stretch: True
    size_hint: 1,1
    keep_ratio: True
    canvas.before:
        StencilPush
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [10]  # Adjust for roundness
        StencilUse

    canvas:
        Color:
            rgba: 1, 1, 1, 1
        Rectangle:
            texture: self.texture  # Keeps the camera feed
            pos: self.pos
            size: self.size

    canvas.after:
        StencilUnUse
        StencilPop
    
